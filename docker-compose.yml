services:

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}
      - AI_SERVICE_URL=http://ai_service:8000

  ai_service:
    build:
      context: ./ai_service
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - STAPI_URL=http://stapi:8080/v1/embeddings
      - SUPABASE_KEY=${SUPABASE_KEY}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_BUCKET=${SUPABASE_BUCKET}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}


  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    command: npm run dev -- --host 0.0.0.0
    depends_on:
      - backend

  stapi:
    image:  ghcr.io/substratusai/stapi
    ports:
      - "8081:8080"
    environment:
      - MODEL=all-MiniLM-L6-v2
      - HF_TOKEN=${HF_TOKEN}

volumes:
  mongo_data:
